<h1 id='a-name-messaging-a-messaging-api-1'><span id=a-name-messaging-a-messaging-api></span><a name="messaging"></a> Messaging API</h1>
<aside class="warning">
This API is under development. Therefore, it may not be ready for use and is a subject to change at any time.
</aside>
<h2 id='a-name-messaging-models-a-common-models-1'><span id=a-name-messaging-models-a-common-models></span><a name="messaging-models"></a> Common models</h2><h3 id='a-name-messaging-message-model-a-message-model-1'><span id=a-name-messaging-message-model-a-message-model></span><a name="messaging-message-model"></a> Message model</h3>
<blockquote>
<p>Message example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">758131</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DD3"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"shorten_urls"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"track_in_shortener"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"campaign_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T10:01:09.467Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T10:01:09.467Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"channels"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">55781</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sms"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"sender"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alphanumeric"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Infinity"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="s2">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
        </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3491</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hei {{name}}"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.625Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.625Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"sendings_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scheduled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"sendings_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="s2">"latest_sending"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3920</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scheduled"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"audience_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">107103</span><span class="p">,</span><span class="w">
    </span><span class="s2">"recipients_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"dispatches_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">9513</span><span class="p">,</span><span class="w">
    </span><span class="s2">"members_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scheduled_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-10-15T15:27:02.853Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transmitted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-10-15T12:45:08.625Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:27:02.853Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.625Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Message stores business-level information and configuration.</p>

<p>It has <a href="#messaging-template-model">Templates</a> through <a href="#messaging-channel-model">Channels</a> (currently only one is supported). </p>

<p>It may be sent, more than once, by scheduling <a href="#messaging-sending-model">Sendings</a> to specific recipients.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong></td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td><strong>name</strong></td>
<td>string</td>
<td></td>
</tr>
<tr>
<td><strong>shorten_urls</strong></td>
<td>boolean</td>
<td>Should sendings for this message have URLs shortened with MPC Shortener?</td>
</tr>
<tr>
<td><strong>track_in_shortener</strong></td>
<td>boolean</td>
<td>Should MPC Shortener track users?</td>
</tr>
<tr>
<td>service</td>
<td>enum</td>
<td>MPC <a href="#messaging-message-service">Service</a> the Message is related to</td>
</tr>
<tr>
<td>campaign_id</td>
<td>integer</td>
<td>MPC&#39;s campaign ID (applicable to <code>campaigns</code> service)</td>
</tr>
<tr>
<td><strong>channels</strong></td>
<td><a href="#messaging-channel-model">Channel</a>[]</td>
<td>Channels the message is sent with</td>
</tr>
<tr>
<td><strong>sendings_status</strong></td>
<td>enum</td>
<td><a href="#messaging-message-sendings-status">Aggregated Sendings status</a></td>
</tr>
<tr>
<td><strong>sendings_count</strong></td>
<td>integer</td>
<td>Number of Sendings of Message</td>
</tr>
<tr>
<td><strong>latest_sending</strong></td>
<td><a href="#messaging-message-sending-model">MessageSending</a></td>
<td>Most recent Sending of Message</td>
</tr>
<tr>
<td><strong>created_at</strong></td>
<td>datetime</td>
<td>Time of creation</td>
</tr>
<tr>
<td><strong>updated_at</strong></td>
<td>datetime</td>
<td>Time of last update</td>
</tr>
</tbody></table>
<h5 id='a-name-messaging-message-sendings-status-a-aggregated-sendings-status-1'><span id=a-name-messaging-message-sendings-status-a-aggregated-sendings-status></span><a name="messaging-message-sendings-status"></a> Aggregated Sendings status</h5>
<p>If all Message&#39;s Sendings are <code>transmitted</code>, <code>cancelled</code>, <code>failed</code> or <code>skipped</code>, then <code>sendings_status</code> is <code>finished</code>.</p>

<p>If all Message&#39;s Sendings are <code>draft</code>, then <code>sendings_status</code> is <code>draft</code>.</p>

<p>If both above conditions are not true, then <code>sendings_status</code> is <code>scheduled</code>.</p>
<h5 id='a-name-messaging-message-sending-model-a-messagesending-model-1'><span id=a-name-messaging-message-sending-model-a-messagesending-model></span><a name="messaging-message-sending-model"></a> MessageSending model</h5>
<p>Simplified version of <a href="#messaging-sending-model">Sending</a>&#39;s with limited set of attributes:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong></td>
<td><a href="#messaging-sending-model">Sending#id</a></td>
</tr>
<tr>
<td>audience_id</td>
<td><a href="#messaging-sending-model">Sending#audience_id</a></td>
</tr>
<tr>
<td><strong>status</strong></td>
<td><a href="#messaging-sending-model">Sending#status</a></td>
</tr>
<tr>
<td><strong>scheduled_at</strong></td>
<td><a href="#messaging-sending-model">Sending#scheduled_at</a></td>
</tr>
<tr>
<td><strong>created_at</strong></td>
<td><a href="#messaging-sending-model">Sending#created_at</a></td>
</tr>
<tr>
<td><strong>transmitted_at</strong></td>
<td><a href="#messaging-sending-model">Sending#transmitted_at</a></td>
</tr>
<tr>
<td><strong>updated_at</strong></td>
<td><a href="#messaging-sending-model">Sending#updated_at</a></td>
</tr>
<tr>
<td><strong>recipients_count</strong></td>
<td>Number of recipients</td>
</tr>
<tr>
<td>dispatches_count</td>
<td>Number of dispatches, when sending has not been executed yet it&#39;s <code>null</code></td>
</tr>
<tr>
<td>members_count</td>
<td>Number of distinct members to whom messages has been sent</td>
</tr>
</tbody></table>
<h4 id='a-name-messaging-message-service-a-service-1'><span id=a-name-messaging-message-service-a-service></span><a name="messaging-message-service"></a> Service</h4>
<p>Service is used to provide special treatment for some types of Messages that are bound to specific MPC features.</p>

<p>A permit is required for managing Messages of each Service.</p>

<table><thead>
<tr>
<th>Service</th>
<th>Permit</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>campaigns</td>
<td>Messages:Api:Messages:UseService:Campaigns</td>
<td>MPC Campaigns messages</td>
</tr>
<tr>
<td>campaigns_testing</td>
<td>Messages:Api:Messages:UseService:CampaignsTesting</td>
<td>MPC Campaigns test messages</td>
</tr>
<tr>
<td>tenants</td>
<td>Messages:Api:Messages:UseService:Tenants</td>
<td>For MPC TEM tenant messages</td>
</tr>
<tr>
<td>tenants_testing</td>
<td>Messages:Api:Messages:UseService:TenantsTesting</td>
<td>For MPC TEM tenant test messages</td>
</tr>
<tr>
<td>tem_documents</td>
<td>Messages:Api:Messages:UseService:TemDocuments</td>
<td>For MPC TEM documents notifications</td>
</tr>
<tr>
<td>tem_documents_reminders</td>
<td>Messages:Api:Messages:UseService:TemDocumentsReminders</td>
<td>For MPC TEM documents reminder notifications</td>
</tr>
</tbody></table>
<h3 id='a-name-messaging-channel-model-a-channel-model-1'><span id=a-name-messaging-channel-model-a-channel-model></span><a name="messaging-channel-model"></a> Channel model</h3>
<blockquote>
<p>Channel example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">55781</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sms"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"sender"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alphanumeric"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Infinity"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
     </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">,</span><span class="w">
     </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hei {{name}}"</span><span class="w"> </span><span class="p">},</span><span class="w">
     </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
     </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.625Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.625Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Channel defines how <a href="#messaging-message-model">Message</a> may be sent along with the content (defined by <a href="#messaging-template-model">Template</a>) that 
should be sent through this channel.</p>

<p>Please note that while we allow to set multiple channels on single message for future usage, 
currently just one (the first) is utilized as the Message&#39;s single channel.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong></td>
<td>integer</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>enum: <code>[&#39;sms&#39;, &#39;email&#39;, &#39;push&#39;]</code></td>
</tr>
<tr>
<td><strong>created_at</strong></td>
<td>datetime</td>
</tr>
<tr>
<td><strong>updated_at</strong></td>
<td>datetime</td>
</tr>
<tr>
<td><strong>template</strong></td>
<td><a href="#messaging-template-model">Template</a></td>
</tr>
<tr>
<td><a href="#messaging-channel-specific-attributes">(channel-specific attributes)</a></td>
<td></td>
</tr>
</tbody></table>
<h4 id='a-name-messaging-channel-specific-attributes-a-channel-specific-attributes-1'><span id=a-name-messaging-channel-specific-attributes-a-channel-specific-attributes></span><a name="messaging-channel-specific-attributes"></a> Channel-specific attributes</h4>
<p>When not provided explicitly, values of all the following attributes are taken from Loyalty Club configuration.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Channel type</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>sender.type</td>
<td><code>sms</code></td>
<td>enum: <code>[&#39;alphanumeric&#39;, &#39;international&#39;]</code></td>
</tr>
<tr>
<td>sender.value</td>
<td><code>sms</code></td>
<td>string</td>
</tr>
<tr>
<td>from_email</td>
<td><code>email</code></td>
<td>string</td>
</tr>
<tr>
<td>from_name</td>
<td><code>email</code></td>
<td>string</td>
</tr>
</tbody></table>

<p>The <code>sender</code> describes how SMS sender will be displayed to the receiver of SMS.
By default, a value from Loyalty Club configuration is used (see <a href="#messaging-show-settings">Messaging &gt; Settings</a>).</p>

<p>Depending on selected <code>sender.type</code>, <code>sender.value</code> can be provided according to the following table:  </p>

<table><thead>
<tr>
<th>Type</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td><code>alphanumeric</code></td>
<td>String consisting of 2-11 characters</td>
</tr>
<tr>
<td><code>international</code></td>
<td>Any MSISDN</td>
</tr>
</tbody></table>
<h3 id='a-name-messaging-template-model-a-template-model-1'><span id=a-name-messaging-template-model-a-template-model></span><a name="messaging-template-model"></a> Template model</h3>
<blockquote>
<p>Template example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5913</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hei {{name}}"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Template describes content of the <a href="#messaging-message-model">Message</a>. </p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong></td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>wrapper_id</td>
<td>integer</td>
<td>ID of <a href="#messaging-template-wrapping">wrapper template</a></td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>enum: <code>[&#39;plain&#39;, &#39;email&#39;, &#39;bee_email&#39;, &#39;push&#39;, &#39;generic&#39;]</code></td>
<td></td>
</tr>
<tr>
<td><strong>content</strong></td>
<td>Object</td>
<td>Definition depends on the <code>type</code>. See below</td>
</tr>
<tr>
<td><strong>created_at</strong></td>
<td>datetime</td>
<td>Time of creation</td>
</tr>
<tr>
<td><strong>updated_at</strong></td>
<td>datetime</td>
<td>Time of last update</td>
</tr>
</tbody></table>

<div class="clear"></div>
<h4 id='a-name-messaging-template-model-plain-a-code-plain-code-template-1'><span id=a-name-messaging-template-model-plain-a-code-plain-code-template></span><a name="messaging-template-model-plain"></a> <code>plain</code> template</h4>
<blockquote>
<p>Plain Template example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hei {{name}}"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This type of template contains only body and can be sent with any channel.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>content.body</strong></td>
<td>string</td>
<td></td>
</tr>
</tbody></table>

<div class="clear"></div>
<h4 id='a-name-messaging-template-model-email-a-code-email-code-template-1'><span id=a-name-messaging-template-model-email-a-code-email-code-template></span><a name="messaging-template-model-email"></a> <code>email</code> template</h4>
<blockquote>
<p>Email Template example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609194</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome!"</span><span class="p">,</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;b&gt;Hei {{name}}&lt;/b&gt;"</span><span class="p">,</span><span class="w"> </span><span class="s2">"preheader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"We welcome you"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This type of template can be assigned to <code>email</code> channel.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td><strong>content.body</strong></td>
<td>HTML</td>
</tr>
<tr>
<td>content.subject</td>
<td>string</td>
</tr>
<tr>
<td>content.preheader</td>
<td>string</td>
</tr>
</tbody></table>

<div class="clear"></div>
<h4 id='a-name-messaging-template-model-bee-email-a-code-bee_email-code-template-1'><span id=a-name-messaging-template-model-bee-email-a-code-bee_email-code-template></span><a name="messaging-template-model-bee-email"></a> <code>bee_email</code> template</h4>
<blockquote>
<p>BeeEmail Template example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bee_email"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome!"</span><span class="p">,</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;b&gt;Hei {{name}}&lt;/b&gt;"</span><span class="p">,</span><span class="w"> </span><span class="s2">"preheader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"We welcome you"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bee_json"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This type of template is used internally by MPC UI. </p>

<p>It differs from <code>email</code> by containing JSON source which is used by <a href="https://docs.beefree.io/">Bee Plugin</a> to generate HTML <code>body</code>. </p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td><strong>content.body</strong></td>
<td>HTML</td>
</tr>
<tr>
<td><strong>content.bee_json</strong></td>
<td>Object</td>
</tr>
<tr>
<td>content.subject</td>
<td>string</td>
</tr>
<tr>
<td>content.preheader</td>
<td>string</td>
</tr>
</tbody></table>

<div class="clear"></div>
<h4 id='a-name-messaging-template-model-push-a-code-push-code-template-1'><span id=a-name-messaging-template-model-push-a-code-push-code-template></span><a name="messaging-template-model-push"></a> <code>push</code> template</h4>
<blockquote>
<p>Push Template example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"push"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome"</span><span class="p">,</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hi {{name}}!"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iml://app/cpn"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This type of template can be assigned to <code>push</code> channel.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td><strong>content.body</strong></td>
<td>string</td>
</tr>
<tr>
<td>content.subject</td>
<td>string</td>
</tr>
<tr>
<td>content.uri</td>
<td>URL</td>
</tr>
</tbody></table>

<div class="clear"></div>
<h4 id='a-name-messaging-template-model-generic-a-code-generic-code-template-1'><span id=a-name-messaging-template-model-generic-a-code-generic-code-template></span><a name="messaging-template-model-generic"></a> <code>generic</code> template</h4>
<blockquote>
<p>Generic Template example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"generic"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome"</span><span class="p">,</span><span class="w"> </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hi {{name}}!"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iml://app/cpn"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-15T12:45:08.618Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This type of template also can be assigned to any channel. But any possible content attribute can be set.</p>

<p>It&#39;s designed to be used as a generic wrapper or in appliances where the template needs to be utilized by messages
sent with various channels.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>content.body</td>
<td>string</td>
</tr>
<tr>
<td>content.subject</td>
<td>string</td>
</tr>
<tr>
<td>content.preheader</td>
<td>string</td>
</tr>
<tr>
<td>content.uri</td>
<td>URL</td>
</tr>
</tbody></table>
<h4 id='a-name-messaging-template-templating-system-a-templating-system-1'><span id=a-name-messaging-template-templating-system-a-templating-system></span><a name="messaging-template-templating-system"></a> Templating system</h4>
<p>We use <a href="https://shopify.github.io/liquid">Liquid</a> template language for generating dynamic Message content.</p>

<p>NOTE: Currently, because of technical reasons, in e-mail messages very limited set of Liquid features is supported - 
it&#39;s demonstrated in examples of this section. However, in pushes and SMSes, full set of features is available.</p>

<p>The set of merge-tags available for given Message depends on recipient type the Message is being sent to.</p>

<blockquote>
<p>Example: Having this as a body of SMS sent to MPC members  </p>
</blockquote>
<pre class="highlight plaintext"><code>{% if dmp.bonus_points %}
    Your points balance is {{ member.bonus_points }}! :)
{% else %}
    You have no points :(
{% endif %}
</code></pre>
<blockquote>
<p>A following text will be received by member that has some points:</p>
</blockquote>
<pre class="highlight plaintext"><code>Your points balance is 540 :)
</code></pre>
<blockquote>
<p>A the following text will be received by member that has no points:</p>
</blockquote>
<pre class="highlight plaintext"><code>You have no points :(
</code></pre>
<p>For MPC members (fetched from <a href="#messaging-sending-audience-payload-model">audience</a> or provided as <a href="#messaging-mpc-recipient-model">MPC members recipients</a>),
their MPC data may be used as merge-tags:</p>

<table><thead>
<tr>
<th>merge-tag</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>member.id</code></td>
<td></td>
</tr>
<tr>
<td><code>member.secret_id</code></td>
<td>Special member&#39;s ID of used to authorize member in some MPC services</td>
</tr>
<tr>
<td><code>member.msisdn</code></td>
<td></td>
</tr>
<tr>
<td><code>member.email</code></td>
<td></td>
</tr>
<tr>
<td><code>member.app_token</code></td>
<td></td>
</tr>
<tr>
<td><code>member.*</code></td>
<td>Member property (e.g. <code>member.first_name</code>) - the set depends on LC configuration</td>
</tr>
<tr>
<td><code>dmp.*</code></td>
<td>DMP value for member (e.g. <code>dmp.bonus_points</code>) - available for audience members only, <br />the set depends on LC configuration</td>
</tr>
</tbody></table>

<div class="clearfix"></div>

<p>For <a href="#messaging-arbitrary-recipient-model">arbitrary recipients</a>, only their identifiers and arbitrary data provided 
within <code>properties</code>  may be used - see example.</p>

<blockquote>
<p>Having arbitrary recipients provided as follows: </p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"piotr@example.com"</span><span class="p">,</span><span class="w"> </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Piotr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"some_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ola@example.com"</span><span class="p">,</span><span class="w"> </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ola"</span><span class="p">,</span><span class="w"> </span><span class="s2">"some_object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<blockquote>
<p>A Template&#39;s content may be defined this way:</p>
</blockquote>
<pre class="highlight plaintext"><code>Hello {{ first_name }}.
Your email is {{ email }}.
Your points balance is {{ some_object.points }}.
</code></pre>
<div class="clear"></div>
<h5 id='a-name-messaging-template-wrapping-a-template-wrapping-1'><span id=a-name-messaging-template-wrapping-a-template-wrapping></span><a name="messaging-template-wrapping"></a> Template wrapping</h5>
<blockquote>
<p>Sample wrapper definition:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"generic"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> 
    </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Important message for {{member.first_name}}"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hi {{member.name}}! {{content}}"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="p">,</span><span class="w"> </span><span class="err">so</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">won't</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">wrapping</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Consider this wrapper to be assigned to a template as follows:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609194</span><span class="p">,</span><span class="w">
  </span><span class="s2">"wrapper_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">609193</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"push"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> 
    </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"I will be replaced by wrapper, as wrapper has no {{content} defined for this property"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Your last name is {{member.last_name}}!"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo://bar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Effectively, following content will be used during sending execution after wrapping and merging:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
  </span><span class="s2">"subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Important message for Piotr"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hi Piotr! Your last name is Świtlicki!"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo://bar"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Any template may be wrapped by another template by providing <code>wrapper_id</code>.</p>

<p>On sending execution, if channel&#39;s template has a wrapper assigned, each content attribute (body, subject, etc) 
of the template will be injected into special <code>{{ content }}</code> merge-tag of corresponding wrapper&#39;s attribute.</p>

<p>When wrapper has no specific content attribute defined, it will be ignored. </p>

<p>Wrapping is not recursive, so if template A has a template B as a wrapper and template B has a template C as a wrapper,
template A will be wrapped by Template B, but template B will not be wrapped by Template C.</p>

<p>The type of wrapper that can be assigned to a template depends on given template type, as follows:</p>

<table><thead>
<tr>
<th>Template type</th>
<th>Wrappable with</th>
</tr>
</thead><tbody>
<tr>
<td><code>plain</code></td>
<td><code>generic</code>, <code>email</code>, <code>bee_email</code>, <code>push</code>, <code>plain</code></td>
</tr>
<tr>
<td><code>generic</code></td>
<td><code>generic</code>, <code>email</code>, <code>bee_email</code>, <code>push</code></td>
</tr>
<tr>
<td><code>email</code></td>
<td><code>generic</code>, <code>email</code>, <code>bee_email</code></td>
</tr>
<tr>
<td><code>push</code></td>
<td><code>generic</code>, <code>push</code></td>
</tr>
<tr>
<td><code>bee_email</code></td>
<td><code>generic</code></td>
</tr>
</tbody></table>
<h3 id='a-name-messaging-sending-model-a-sending-model-1'><span id=a-name-messaging-sending-model-a-sending-model></span><a name="messaging-sending-model"></a> Sending model</h3>
<blockquote>
<p>Sending example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000016</span><span class="p">,</span><span class="w">
  </span><span class="s2">"audience_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">106642</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scheduled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"scheduled_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-18T09:28:59.918Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"scheduled_with"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"in"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15 minutes"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"relative"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-18T09:13:59.937Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-18T09:13:59.937Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"transmitted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-18T09:13:59.937Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"dispatches_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">4912</span><span class="p">,</span><span class="w">
  </span><span class="s2">"recipients"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"member_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w">
      </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"app_token"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Piotr"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong></td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>audience_id</td>
<td>integer</td>
<td>ID of audience the sending is directed to</td>
</tr>
<tr>
<td><strong>status</strong></td>
<td>string</td>
<td>See: <a href="#messaging-sending-status">Sending status</a></td>
</tr>
<tr>
<td><strong>scheduled_at</strong></td>
<td>datetime</td>
<td>Time of sending execution</td>
</tr>
<tr>
<td>scheduled_with</td>
<td>Object</td>
<td>Params the sending has been scheduled with - See <a href="#messaging-sending-schedule-payload-model">SendingSchedulePayload</a></td>
</tr>
<tr>
<td>dispatches_count</td>
<td>Number of dispatches, when sending has not been executed yet it&#39;s <code>null</code></td>
<td></td>
</tr>
<tr>
<td><strong>transmitted_at</strong></td>
<td>datetime</td>
<td>Time of sending transmission</td>
</tr>
<tr>
<td><strong>created_at</strong></td>
<td>datetime</td>
<td>Time of creation</td>
</tr>
<tr>
<td><strong>updated_at</strong></td>
<td>datetime</td>
<td>Time of update</td>
</tr>
<tr>
<td><strong>recipients</strong></td>
<td><a href="#messaging-recipient-model">Recipient</a>[]</td>
<td>Inline recipients the sending is directed to</td>
</tr>
</tbody></table>
<h4 id='a-name-messaging-sending-status-a-sending-status-1'><span id=a-name-messaging-sending-status-a-sending-status></span><a name="messaging-sending-status"></a> Sending status</h4>
<p>The Sending may have one of following statuses, which may be grouped into <strong>initial states</strong>, <strong>execution steps</strong> and the <strong>final outcomes</strong>:</p>

<ul>
<li><strong>initial states</strong>:

<ul>
<li><strong>draft</strong> - When API client didn&#39;t&#39;t define the schedule (or has <code>draft: true</code> flag)</li>
<li><strong>scheduled</strong> - When scheduled to be sent at specific time by API client</li>
</ul></li>
</ul>

<p>Sending may have status changed from <code>draft</code> to <code>scheduled</code>  and vice versa, as long as the execution haven&#39;t started yet.  </p>

<ul>
<li><strong>execution steps</strong>:

<ul>
<li><strong>preparing</strong> - Building Dispatches for Recipients and Audience members</li>
<li><strong>prepared</strong> - Dispatches are built, ready for transmission</li>
<li><strong>transmitting</strong> - Dispatches are being transmitted</li>
</ul></li>
</ul>

<p>Preparing is a process that builds Dispatches for given recipients. Potentially Sendings may have very large Audiences assigned, 
so it may take some time to build Dispatches for all of them. Therefore, the preparation starts 5 minutes before the actual transmission.</p>

<ul>
<li><strong>final outcomes</strong>: 

<ul>
<li><strong>transmitted</strong> - When the Dispatches have been transmitted</li>
<li><strong>skipped</strong> - When no recipients could be resolved for it (for example, Audience may lose its members over time).</li>
<li><strong>cancelled</strong> - When cancelled by API client at any point of execution (see: <a href="#messaging-cancel-sending">Sending cancellation</a>.</li>
<li><strong>failed</strong> - When the execution couldn&#39;t be finished in about 20 minutes after the desired time </li>
</ul></li>
</ul>

<p>Whenever Sending is <code>cancelled</code> or <code>failed</code>, it cannot be rescheduled again. 
It must be created again, for example with <a href="#todo">Clone sending endpoint</a>. </p>
<h3 id='a-name-messaging-dispatch-model-a-dispatch-model-1'><span id=a-name-messaging-dispatch-model-a-dispatch-model></span><a name="messaging-dispatch-model"></a> Dispatch model</h3>
<blockquote>
<p>Dispatch example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">173</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sms"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hi Piotr"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"member_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">46085834</span><span class="p">,</span><span class="w">
    </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+4740769126"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"app_token"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transmission_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"transmitted"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"delivery_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"delivered"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"external_delivery_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"delivered"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-11-18T22:47:45.191Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-11-18T22:47:52.016Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scheduled_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-11-18T22:47:45.066Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transmitted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-11-18T22:47:45.495Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"delivered_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-11-18T22:47:48.000Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cleaned_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong></td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>enum: [&#39;sms&#39;, &#39;email&#39;, &#39;push&#39;]</td>
<td></td>
</tr>
<tr>
<td><strong>content</strong></td>
<td>object</td>
<td>Depends on Dispatch type</td>
</tr>
<tr>
<td>member_id</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>msisdn</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>app_token</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td><strong>transmission_status</strong></td>
<td>enum: [&#39;scheduled&#39;, &#39;transmitted&#39;, &#39;failed&#39;]</td>
<td>Describes status of transmission within Messages API</td>
</tr>
<tr>
<td><strong>delivery_status</strong></td>
<td>enum: [&#39;pending&#39;, &#39;delivered&#39;, &#39;failed&#39;]</td>
<td>Describes status of delivery within external senders</td>
</tr>
<tr>
<td><strong>created_at</strong></td>
<td>datetime</td>
<td>Time of creation</td>
</tr>
<tr>
<td><strong>updated_at</strong></td>
<td>datetime</td>
<td>Time of update</td>
</tr>
<tr>
<td><strong>scheduled_at</strong></td>
<td>datetime</td>
<td>Time when the Dispatch was meant to be sent</td>
</tr>
<tr>
<td><strong>transmitted_at</strong></td>
<td>datetime</td>
<td>Time when the Dispatch has been transmitted to external senders</td>
</tr>
<tr>
<td><strong>delivered_at</strong></td>
<td>datetime</td>
<td>Time when the Dispatch has been delivered to recipient</td>
</tr>
<tr>
<td><strong>cleaned_at</strong></td>
<td>datetime</td>
<td>Time when the Dispatch has been stripped off from personal data (content and identifiers)</td>
</tr>
</tbody></table>
<h3 id='a-name-messaging-recipient-model-a-recipient-model-1'><span id=a-name-messaging-recipient-model-a-recipient-model></span><a name="messaging-recipient-model"></a> Recipient model</h3>
<blockquote>
<p>Recipient example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"member_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w">
  </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4740769126"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"recipient@example.com"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"app_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c6OE_joK28g:APA91bFkT5fzhdWJMJswPo3btVLxtMmhi7jKdOE_VL1IhkSmuoz3iEQMg4Cq"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Piotr"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>member_id</td>
<td>integer</td>
<td>ID of MPC member</td>
</tr>
<tr>
<td>msisdn</td>
<td><a href="#msisdn-param">MSISDN</a></td>
<td></td>
</tr>
<tr>
<td>email</td>
<td>email</td>
<td></td>
</tr>
<tr>
<td>app_token</td>
<td>email</td>
<td></td>
</tr>
<tr>
<td>properties</td>
<td>Object</td>
<td>Arbitrary keys that can be used as <a href="#messaging-templating-system">merge-tags</a> in the message template</td>
</tr>
</tbody></table>

<p><br />
Recipient may be an MPC member (identified by <code>member_id</code>) or an arbitrary sending receivers - <code>msisdn</code>, <code>email</code> or <code>push</code>.  </p>
<h4 id='a-name-messaging-mpc-recipient-model-a-mpc-member-recipient-1'><span id=a-name-messaging-mpc-recipient-model-a-mpc-member-recipient></span><a name="messaging-mpc-recipient-model"></a> MPC member recipient</h4>
<p>When <code>member_id</code> is provided, other identifiers will be ignored and actual identifiers for sending execution will 
be fetched from MPC member&#39;s data (for example, for <code>sms</code> channel member&#39;s <code>msisdn</code> will be used as a sending receiver).</p>

<p>merge-tags for template will be fetched from MPC Members - but may be extended/replaced with provided <code>properties</code>.</p>
<h4 id='a-name-messaging-arbtrary-recipient-model-a-arbitrary-identifier-recipient-1'><span id=a-name-messaging-arbtrary-recipient-model-a-arbitrary-identifier-recipient></span><a name="messaging-arbtrary-recipient-model"></a> Arbitrary identifier recipient</h4>
<p>Without <code>member_id</code>, at least one identifier relevant to message&#39;s channels definition is required.</p>

<p>For example, if <code>sms</code> and <code>email</code> channels are defined on message, <code>msisdn</code> or <code>email</code> is required.</p>

<p>Given <code>properties</code> will be used as template&#39;s merge-tags. </p>
<h3 id='a-name-messaging-dispatch-member-model-a-dispatch-member-model-1'><span id=a-name-messaging-dispatch-member-model-a-dispatch-member-model></span><a name="messaging-dispatch-member-model"></a> Dispatch member model</h3>
<p>Member to whom dispach has been sent</p>

<blockquote>
<p>Dispatch member example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">173</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sms"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"app_tokens"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"token_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"token_2"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong></td>
<td>integer</td>
<td>Member id</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>enum: [&#39;sms&#39;, &#39;email&#39;, &#39;push&#39;]</td>
<td></td>
</tr>
<tr>
<td>msisdn</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>app_tokens</td>
<td>array</td>
<td>array of app_tokens</td>
</tr>
</tbody></table>
